<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News - Tea Industry Aggregator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>

    <header class="site-header">
        <div class="header-top-bar">
            <div class="header-logo">
                <a href="/" class="logo-link">
                    <h1>Tea<span>Trade</span></h1>
                </a>
            </div>
            <div class="header-search-wrapper">
                 <input type="search" class="header-search-bar" placeholder="Search...">
            </div>
            <div class="user-actions">
                </div>
            <button class="mobile-menu-toggle" aria-label="Open menu" id="menu-toggle">
                <svg viewBox="0 0 24 24" fill="#5f6368"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
            </button>
        </div>
        <nav class="secondary-nav" id="main-nav">
             <ul>
                <li><a href="/news.html" class="active">News</a></li>
                <li><a href="#">Data Library</a></li>
                <li><a href="#">Market Reports</a></li>
            </ul>
        </nav>
    </header>

    <main class="page-container">
        
        <div id="news-filter-bar">
            <div class="news-filter-controls">
                <input type="text" id="keyword-filter" placeholder="Search keywords...">
                <select id="source-filter">
                    <option value="all">All Sources</option>
                    </select>
            </div>
            <div id="article-count">Loading...</div>
        </div>

        <div id="news-container" class="news-list">
            </div>

        <div id="pagination-controls" class="hidden">
            <button id="prev-btn" class="page-btn" disabled>Previous</button>
            <span id="page-info">Page 1</span>
            <button id="next-btn" class="page-btn">Next</button>
        </div>
    </main>

    <footer>
        <p>© 2025 TeaTrade. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Mobile Menu Toggle Logic (Based on CSS structure) ---
            const menuToggle = document.getElementById('menu-toggle');
            const mainNav = document.getElementById('main-nav');
            if (menuToggle && mainNav) {
                menuToggle.addEventListener('click', () => {
                    mainNav.classList.toggle('is-active');
                });
            }

            // --- News Pagination and Filtering Logic ---
            const ARTICLES_PER_PAGE = 20;
            const newsContainer = document.getElementById('news-container');
            // Convert NodeList to Array for easier manipulation
            const allArticles = Array.from(newsContainer.getElementsByClassName('news-item'));
            
            const keywordFilter = document.getElementById('keyword-filter');
            const sourceFilter = document.getElementById('source-filter');
            const articleCountDisplay = document.getElementById('article-count');
            const paginationControls = document.getElementById('pagination-controls');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const pageInfo = document.getElementById('page-info');

            let currentPage = 1;
            let filteredArticles = [...allArticles]; // Start with all articles

            // 1. Populate Source Filter Options
            const populateSources = () => {
                const sources = new Set();
                allArticles.forEach(article => {
                    const sourceElement = article.querySelector('.source');
                    if (sourceElement) {
                        // Extract source name (text before the first dash)
                        // Assumes format: "Source Name - Date" or "Source Name"
                        const sourceText = sourceElement.textContent.split(' - ')[0].trim();
                        if (sourceText) {
                            sources.add(sourceText);
                            // Store source in a data attribute for efficient filtering
                            article.dataset.source = sourceText; 
                        }
                    }
                });
                
                // Sort sources alphabetically
                Array.from(sources).sort().forEach(source => {
                    const option = document.createElement('option');
                    option.value = source;
                    option.textContent = source;
                    sourceFilter.appendChild(option);
                });
            };

            // 2. Filter Articles
            const filterArticles = () => {
                const keyword = keywordFilter.value.toLowerCase().trim();
                const selectedSource = sourceFilter.value;

                filteredArticles = allArticles.filter(article => {
                    // Keyword match (headline, snippet, source)
                    const textContent = article.textContent.toLowerCase();
                    const matchesKeyword = keyword === "" || textContent.includes(keyword);

                    // Source match (using data attribute)
                    const matchesSource = selectedSource === "all" || article.dataset.source === selectedSource;
                    
                    return matchesKeyword && matchesSource;
                });

                // Reset to page 1 when filters change
                currentPage = 1;
                displayPage(currentPage);
            };

            // 3. Display Page
            const displayPage = (page) => {
                const totalFiltered = filteredArticles.length;
                const totalPages = Math.ceil(totalFiltered / ARTICLES_PER_PAGE);

                if (totalFiltered === 0) {
                    // Hide all articles
                    allArticles.forEach(article => article.classList.add('hidden'));
                    articleCountDisplay.textContent = "No matching articles found.";
                    paginationControls.classList.add('hidden');
                    return;
                }

                // Ensure page number is valid
                if (page < 1) page = 1;
                if (page > totalPages) page = totalPages;
                currentPage = page;

                // Hide all articles first
                allArticles.forEach(article => article.classList.add('hidden'));

                const start = (page - 1) * ARTICLES_PER_PAGE;
                const end = start + ARTICLES_PER_PAGE;
                const pageArticles = filteredArticles.slice(start, end);

                // Show articles for the current page
                pageArticles.forEach(article => article.classList.remove('hidden'));

                // Update UI elements
                updatePaginationUI(page, totalPages);
                updateArticleCount(start, pageArticles.length, totalFiltered);
                
                // Show controls if needed
                if (totalPages > 1) {
                    paginationControls.classList.remove('hidden');
                } else {
                    paginationControls.classList.add('hidden');
                }
            };

            // 4. Update UI Helpers
            const updatePaginationUI = (page, totalPages) => {
                pageInfo.textContent = `Page ${page} of ${totalPages}`;
                prevBtn.disabled = page <= 1;
                nextBtn.disabled = page >= totalPages;
            };

            const updateArticleCount = (start, countOnPage, total) => {
                const end = start + countOnPage;
                // Use 1-based indexing for display
                articleCountDisplay.textContent = `Showing ${start + 1}–${end} of ${total} articles`;
            };

            // 5. Event Listeners
            // Use 'input' for live keyword searching
            keywordFilter.addEventListener('input', filterArticles); 
            sourceFilter.addEventListener('change', filterArticles);

            const scrollToTop = () => {
                // Scroll smoothly to the top of the page container or header
                const header = document.querySelector('.site-header') || document.body;
                header.scrollIntoView({ behavior: 'smooth', block: 'start' });
            };

            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    displayPage(currentPage - 1);
                    scrollToTop();
                }
            });

            nextBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(filteredArticles.length / ARTICLES_PER_PAGE);
                if (currentPage < totalPages) {
                    displayPage(currentPage + 1);
                    scrollToTop();
                }
            });

            // Initial Setup
            if (allArticles.length > 0) {
                populateSources();
                displayPage(currentPage);
            } else {
                articleCountDisplay.textContent = "No articles loaded.";
            }
        });
    </script>

</body>
</html>